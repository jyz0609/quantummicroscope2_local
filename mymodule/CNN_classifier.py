import os
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
#import tensorflow as tf
#from tensorflow.keras.models import load_model
import time


def normalized(arr=np.zeros(50),model_name="CNN_model_0905_onmeasured_len50.h5"):
    """
    Takes a 1D NumPy array as input.
    - If the array length is smaller than 50, raises a ValueError.
    - Otherwise, takes the first 50 elements and performs some processing.
    """
    # Ensure input is numpy array
    if not isinstance(arr, np.ndarray):
        raise TypeError("Input must be a NumPy array.")

    # Ensure it's 1D
    if arr.ndim != 1:
        raise ValueError(f"Expected a 1D array, got {arr.ndim}D.")

    # Check length
    if arr.size < 50:
        raise ValueError(f"Array length {arr.size} is smaller than 50.")

    # Take first 50 elements
    sub_arr = arr[:50]
    model_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), model_name)
    print(f"model path is {model_path}")

    start = time.time()
    try:
        model = load_model(model_path)
        print("✅ model loaded：", model_path)
    except Exception as e:
        raise RuntimeError(f"❌ fail to load the model：{e}")
    end = time.time()
    print(f"loading time is {end - start:.4f}second")
    X = sub_arr.reshape(-1, 50, 1)

    pred_prob = model.predict(X, verbose=0)
    pred_prob = round(pred_prob.item(),4)
    return pred_prob

if __name__ == "__main__":
    start = time.time()
    arr01412 = [0.2000,0.5000,0.3000,0.9000,0.3000,0.6000,0.7000,1.4000,0.9000,0.8000,1.2000,0.3000,1.5000,1.1000,0.9000,1.2000,1.5000,1.4000,1.1000,2.0000,0.9000,1.4000,1.2000,0.9000,1.4000,0.9000,1.1000,0.9000,1.0000,1.3000,1.3000,1.4000,1.5000,1.6000,1.0000,1.0000,0.8000,1.3000,0.9000,0.9000,0.8000,1.3000,1.2000,0.8000,1.0000,0.9000,1.2000,1.4000,0.9000,1.0000,1.1000,1.3000,0.7000,1.1000,1.4000,0.6000,0.8000,1.4000,1.5000,0.7000,0.7000,1.0000,0.8000,1.0000,1.7000,0.9000,1.4000,0.5000,1.5000,1.1000,1.3000,1.1000,1.2000,1.0000,0.9000,1.0000,1.2000,1.3000,1.5000,1.1000,0.4000,1.0000,1.4000,1.2000,0.7000,0.9000,0.3000,1.0000,1.2000,1.6000,0.9000,0.8000,1.1000,1.3000,0.9000,1.0000,1.1000,1.0000,0.8000,0.6000,0.9000,1.0000,1.0000,1.1000,1.0000,1.0000,1.3000,1.6000,0.7000,1.1000,1.1000,0.6000,0.9000,1.1000,1.2000,1.0000,0.9000,0.6000,1.2000,0.9000,0.7000,1.5000,1.3000,1.4000,1.5000,1.2000,0.8000,1.2000,1.4000,0.8000,1.4000,1.0000,1.3000,0.8000,1.0000,0.6000,0.6000,1.0000,1.3000,1.2000,0.4000,0.7000,1.3000,1.0000,1.4000,0.5000,0.9000,1.0000,1.0000,0.9000,0.8000,1.4000,0.7000,0.7000,0.5000,1.0000,1.2000,1.0000,0.8000,0.5000,1.1000,0.9000,0.8000,0.7000,0.9000,1.1000,1.5000,1.0000,0.8000,1.2000,0.3000,0.8000,0.7000,0.8000,0.7000,0.8000,1.1000,1.4000,0.7000,0.8000,0.7000,0.9000,1.3000,0.2000,0.5000,1.1000,0.8000,1.3000,1.1000,0.9000,1.1000,0.9000,1.0000,1.3000,1.5000,1.0000,0.7000,0.7000,1.0000,1.4000,1.3000,1.1000,1.2000,0.9000,1.1000,0.9000,1.3000,0.6000,0.7000,0.8000,1.0000,1.2000,0.9000,0.7000,1.0000,0.6000,0.5000,0.7000,0.2000,0.8000,1.5000,1.2000,0.6000,1.2000,0.5000,0.7000,0.8000,1.0000,0.9000,1.1000,1.2000,1.1000,1.0000,1.2000,1.1000,1.2000,0.6000,0.5000,0.7000,0.7000,1.2000,1.1000,1.4000,1.0000,1.2000,0.6000,1.3000,0.9000,1.4000,0.5000]
    arr08154= [0.8000,1.1000,0.6000,0.9000,0.8000,0.8000,0.4000,1.1000,0.8000,0.6000,1.1000,0.8000,0.9000,1.6000,1.0000,0.6000,1.0000,1.6000,1.3000,1.3000,1.1000,1.3000,0.8000,1.8000,1.6000,1.2000,1.0000,0.3000,1.7000,0.8000,1.1000,1.2000,0.9000,1.6000,1.0000,1.1000,1.0000,1.4000,0.7000,1.0000,1.3000,1.3000,1.0000,1.6000,1.4000,1.2000,1.3000,0.9000,0.7000,0.9000,0.6000,0.6000,1.7000,0.1000,0.7000,0.7000,1.0000,1.2000,1.0000,0.7000,0.8000,0.6000,1.2000,1.1000,1.2000,0.7000,1.4000,1.0000,1.1000,1.4000,1.2000,0.7000,1.3000,1.4000,0.8000,1.0000,1.2000,1.1000,1.2000,1.5000,1.1000,1.3000,0.9000,1.3000,1.2000,1.1000,1.4000,1.3000,1.0000,1.2000,0.6000,1.3000,1.2000,1.0000,1.2000,0.9000,0.8000,1.0000,1.6000,0.9000,1.1000,0.8000,0.8000,0.9000,0.8000,1.3000,1.3000,1.1000,1.1000,1.1000,1.1000,1.2000,1.0000,0.7000,0.9000,2.1000,0.9000,1.0000,1.4000,1.2000,0.7000,0.9000,1.1000,1.1000,1.0000,1.2000,1.4000,0.7000,1.3000,0.9000,1.2000,1.7000,0.8000,1.3000,1.7000,0.4000,1.4000,1.0000,1.0000,1.2000,1.6000,1.3000,0.8000,1.1000,0.7000,0.4000,1.0000,1.2000,1.6000,0.7000,1.1000,1.1000,1.0000,0.8000,0.4000,0.6000,1.7000,0.9000,0.7000,0.5000,0.7000,1.2000,0.5000,0.8000,0.6000,0.9000,1.2000,0.8000,1.1000,0.8000,0.9000,0.7000,0.9000,0.9000,1.1000,1.0000,0.9000,1.1000,1.5000,1.0000,1.0000,1.0000,0.9000,1.0000,1.5000,1.1000,1.5000,0.7000,0.7000,1.6000,0.5000,1.6000,0.9000,1.5000,1.0000,1.2000,0.8000,1.2000,0.9000,1.2000,1.3000,1.0000,0.4000,1.3000,1.6000,1.0000,0.4000,1.3000,1.2000,1.0000,0.8000,0.8000,1.2000,0.9000,1.0000,0.9000,1.3000,1.0000,0.9000,1.2000,1.2000,0.9000,1.3000,0.6000,1.4000,0.8000,0.9000,1.2000,1.4000,1.2000,1.3000,1.5000,0.8000,0.3000,0.9000,0.4000,1.2000,1.1000,0.9000,1.4000,1.0000,0.8000,0.9000,1.0000,1.0000,1.4000,1.1000,1.1000,0.7000,1.3000]

    print(f"{normalized(np.array(arr01412))}")
    end = time.time()
    print(f"processing time is {end - start:.4f}second")
